
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">


<div class="x_panel">
    <div class="x_title">
        <h2><small>Licenciamiento Rutinas Revit</small></h2> 
        <div class="clearfix"></div>
    </div>
    <div class="x_content">

        <ul class="nav nav-tabs justify-content-end bar_tabs" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="ingreso-tab" data-toggle="tab" href="#ingreso" role="tab" aria-controls="ingreso" aria-selected="true">Registrar Licencia</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="listar-tab" data-toggle="tab" href="#listar" role="tab" aria-controls="listar" aria-selected="false">Listar Licencias</a>
                </li>
        </ul>
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="ingreso" role="tabpanel" aria-labelledby="ingreso-tab">
                  <div class="col-md-4">
                        <div class="alert alert-secondary" role="alert">
                            <h2>Formulario Registro de Licencia</h2>
                            <form id="registraLicencia" action="#" method="POST">
                                <div class="item form-group">
					                <label class="col-form-label col-md-3 col-sm-3 label-align" for="titulo">Ingrese Mail</label>
                                    <div class="col-md-6">
										<input type="text" id="email" name="email" required="required" class="form-control" value="dbenites@renelagos.com">
								    </div>
                                    <div class="col-md-3">
                                        
                                    </div>  
                                </div>
                                <div class="item form-group">
                                    <label class="col-form-label col-md-3 col-sm-3 label-align" for="titulo">Hard Disk Serial</label>
                                    <div class="col-md-6">
										<input type="text" id="hdserial" name="hdserial" required="required" class="form-control" value="2K242LAGSQEA">
								    </div>
                                    <div class="col-md-3">
                                        <button type="button" class="btn btn-success" onclick="validarRegistro();">Validar</button>
                                    </div>
                                </div>
                                <div class="item form-group">
                                     <div class="col-md-4">

                                     </div>
                                     <div class="col-md-2">
                                            <button type="button" class="btn btn-success" onclick="Ingresar();" disabled id="buttonIngreso" name="buttonIngreso" >Ingresar</button>
                                     </div>

                                </div>
                            </form>
                        </div>
                  </div>
                  <div class="col-md-8">
                        <table class="table table-hover" name="tablaLicencias" id="tablaLicencias" style="width: 100%;">
                            <thead>
                                <tr>
                                        <th>Colaborador</th>
                                        <th>Mail</th>
                                        <th>Ingresado por</th>
                                        <th>Fecha Inicio</th>
                                        <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each licencias}}
                                     <tr>
                                        <td>{{nombreCol}}</td>
                                        <td>{{email}}</td>
                                        <td>{{nombreIng}}</td>
                                        <td>{{fecha_inicio}}</td>
                                        <td>
                                            <a href="/revit/permisosRevit/{{id_usuario}}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-plus" viewBox="0 0 16 16">
                                            <path d="M6 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H1s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C9.516 10.68 8.289 10 6 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
                                            <path fill-rule="evenodd" d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5z"/>
                                            </svg>
                                            </a>
                                            &nbsp;
                                            <a href="/revit/DescargarLicencia/{{id}}" target="_blank">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16";>
                                                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                                                <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                                                </svg>
                                            </a>
                                            
                                            &nbsp;
                                            <a >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-square-fill" viewBox="0 0 16 16" onclick="EliminarLicencia({{id}})";>
                                            <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm3.354 4.646L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 1 1 .708-.708z"/>
                                            </svg>
                                            </a>
                                        </td>
                                    </tr>
                                {{/each}}  
                            </tbody>
                        </table>

                  </div>
                  
            </div>
            <div class="tab-pane fade" id="listar" role="tabpanel" aria-labelledby="listar-tab">
                    Listar licencias registradas. 
            </div>
        </div>

    </div>
</div>


<script src="https://code.jquery.com/jquery-3.5.1.min.js"  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="../../../template/vendors/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="../../../template/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script> 
<script src="../../../template/vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>


<script>

            var table = $('#tablaLicencias').DataTable({
             "dom": "<'row'<'col-sm-12 col-md-6'f><'col-sm-12 col-md-6'l>>" +
                "<'row'<'col-sm-12'tr>>" +
                "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
            orderCellsTop: true,
            fixedHeader: true,
            "scrollX": true,
            language: {
                "decimal": ".",
                "thousands": ",",
                "emptyTable": "No hay informaci√≥n",
                "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
                "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
                "infoFiltered": "(Filtrado de _MAX_ total entradas)",
                "infoPostFix": "",
                "thousands": ",",
                "lengthMenu": "Mostrar _MENU_ Entradas",
                "loadingRecords": "Cargando...",
                "processing": "Procesando...",
                "search": "Buscar:",
                "zeroRecords": "Sin resultados encontrados",
                "paginate": {
                    "first": "Primero",
                    "last": "Ultimo",
                    "next": "Siguiente",
                    "previous": "Anterior"
                }
            }
        });

    function validarRegistro()
    {
        // validar informacion para el registro

         let email      = $("#email").val();
         let hdserial   = $("#hdserial").val();

        // _________________________________________
        // ir a preguntar a la base de datos si tiene  licencia generada
        // 2K242LAGSQEA
        // dbenites@renelagos.com
        // alert(email + "---" + hdserial ); 


         let informacion = {  email,  hdserial};


        $.ajax({
                type: 'post',
                //url: '/finanzas/ocCambioEstado',
                url: '/revit/verificoLicencia',
                data: informacion,
                dataType: 'text'
                })
                .done(function (response) {
                    //$("#edificiotorre").html(data);

                   var resultado = JSON.parse(response);

                   if (resultado.error == 0)
                   {
                        $('#buttonIngreso').removeAttr("disabled");
                        // dejar datos readOnly

                   }
                   else
                   {
                        //$('#buttonIngreso').removeAttr("disabled");
                    // enviar algun mensaje de error a la pantalla. 
                   } 
                });
    }


    function Ingresar()
    {
        let email      = $("#email").val();
        let hdserial   = $("#hdserial").val();

         let informacion = {  email,  hdserial};

                $.ajax({
                type: 'post',
                url: '/revit/crearLicencia',
                data: informacion,
                dataType: 'text'
                })
                .done(function (response) {
                    location.reload();
                });
    }


    function EliminarLicencia( id)
    {


         let informacion = {  id};

                $.ajax({
                type: 'post',
                url: '/revit/eliminarLicencia',
                data: informacion,
                dataType: 'text'
                })
                .done(function (response) {
                    location.reload();
                });


    }


    function DescargarLicencia(id)
    {


        let informacion = {  id};

                $.ajax({
                type: 'post',
                url: '/revit/DescargarLicencia',
                data: informacion,
                dataType: 'text'
                })
                .done(function (response) {
                    //location.reload();
                });
    }
</script>