    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<link rel="stylesheet" href="//code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">

    <div class="col-md-4 col-sm-4  ">
        <div class="x_panel">
            <div class="x_title">
                <h2>Crear Configuración General</h2>
                <div class="clearfix"></div>
            </div>
            <div class="x_content">
                <div class="form-group row">
                        <label class="col-sm-2 col-form-label"	for="Destinatario">Proyecto:</label>
                            <div class="col-sm-8">
                                <input id="idxProyecto" name="idxProyecto"  class="form-control">
                                
                                <input type="hidden" id="idProyecto" name="idProyecto" value="0">  
                            </div>
                    </div>
                <!--
                    <div class="form-group row">
                            <label for="staticEmail" class="col-sm-2 col-form-label">Proyecto</label>
                            <div class="col-sm-8">
                                <select class="form-control" name="id_proyecto" id="id_proyecto" >
                                    <option>Seleccione un proyecto</option>
                                        {{#each proyectos}}
                                            <option value="{{id}}">{{year}}_{{code}} {{nombre}}</option>
                                        {{/each}}
                                </select>
                            </div>
                </div>
                -->
                <div class="form-group row">
                            <label for="staticEmail" class="col-sm-2 col-form-label">Origen</label>
                            <div class="col-sm-8">
                                <select class="form-control" name="id_origen" id="id_origen" >
                                    <option value="0">Seleccione un Origen</option>
                                        {{#each origenes}}
                                            <option value="{{id_origen}}">{{descripcion}}</option>
                                        {{/each}}
                                </select>
                            </div>
                </div>
                <div class="form-group row">
                    <label for="staticEmail" class="col-sm-2 col-form-label">Código</label>
                      <div class="col-sm-8">
                        <input type="text" id="codigo" class="form-control" value="{{centro.centroCosto}}" name="codigo" required />
                      </div>
                    
                </div>
                <div class="form-group row">
                    <button type="button" class="btn btn-warning btn-block" onclick="validarIngresoCodigo();">
                                        Ingresar
                    </button>
                </div>
            </div>
        </div>
    </div>


    <div class="col-md-7">
        <div class="x_panel">
            <div class="x_title">
                <h2>Listado Configuracion Inicial de Proyectos</h2>
                <div class="clearfix"></div>
            </div>
            <div class="x_content">
                    <table class="table table-hover" name="tablaCodigos" id="tablaCodigos" style="width: 100%;">
                            <thead>
                                <tr>
                                        <th>Proyecto</th>
                                        <th>Origen</th>
                                        <th>Código</th>
                                        <th>Opciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                 {{#each codigos}}
                                 <tr>
                                        <td>{{nombre}}</td>
                                        <td>{{descripcion}}</td>
                                        <td>{{annio}}_{{code}}</td>
                                        <td>
                                            <a href="/revit/seteoProyecto/{{id}}" data-toggle="tooltip" data-placement="top" title="Editar Configuración">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
                                            <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                                            </svg>
                                            </a>

                                            <a href="/revit/cargoInfoProyecto/{{id}}" data-toggle="tooltip" data-placement="top" title="Importar Conf. General">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd" d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
                                            <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                                            <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                                            </svg>
                                            </a>
                                        </td>
                                </tr>
                                 {{/each}} 
                            </tbody>
                    </table>
            </div>
        </div>
    </div>

  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>


<script src="../../../template/vendors/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="../../../template/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script> 
<script src="../../../template/vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>


  

<script>
    var nuevoalias = jQuery.noConflict();
	    nuevoalias(document).ready(function() {
	      nuevoalias( function() {

                nuevoalias( "#idxProyecto" ).autocomplete({
                source: "/solicitudes/buscarPro/find=da",
                minLength: 2,
                select: function( event, ui ) {
                    nuevoalias('#idProyecto').val(ui.item.id);
                }
                });
            } );        


	});

            var table = nuevoalias('#tablaCodigos').DataTable({
             "dom": "<'row'<'col-sm-12 col-md-6'f><'col-sm-12 col-md-6'l>>" +
                "<'row'<'col-sm-12'tr>>" +
                "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
            orderCellsTop: true,
            fixedHeader: true,
            "scrollX": true,
            language: {
                "decimal": ".",
                "thousands": ",",
                "emptyTable": "No hay información",
                "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
                "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
                "infoFiltered": "(Filtrado de _MAX_ total entradas)",
                "infoPostFix": "",
                "thousands": ",",
                "lengthMenu": "Mostrar _MENU_ Entradas",
                "loadingRecords": "Cargando...",
                "processing": "Procesando...",
                "search": "Buscar:",
                "zeroRecords": "Sin resultados encontrados",
                "paginate": {
                    "first": "Primero",
                    "last": "Ultimo",
                    "next": "Siguiente",
                    "previous": "Anterior"
                }
            }
        });


            if ("{{verToask.tipo}}" == "Editar") {
        toastr.warning('{{verToask.body}}', '{{verToask.titulo}}', {
            "progressBar": true
        });
    }
    else if ("{{verToask.tipo}}" == "Crear") {
        toastr.success('{{verToask.body}}', '{{verToask.titulo}}', {
            "progressBar": true
        });
    }
    else if ("{{verToask.tipo}}" == "Eliminar") {
        toastr.error('{{verToask.body}}', '{{verToask.titulo}}', {
            "progressBar": true
        });
    }
    else if ("{{verToask.tipo}}" == "Permisos") {
        toastr.success('{{verToask.body}}', '{{verToask.titulo}}', {
            "progressBar": true
        });
    }


function validarIngresoCodigo()
{

     //let id_proyecto = $("#id_proyecto").val();
     let id_proyecto = $("#idProyecto").val();
     let id_origen   = $("#id_origen").val();
     let codigo      = $("#codigo").val();

     let infoCodigo = codigo.split('_');

     if (infoCodigo.length != 2)
     {
        alert("El codigo tiene que tener un Guion Bajo para que sea válido. Ejemplo 2016_02C ");
        return false;
     }




        if (id_proyecto != "0" &&
            id_origen != "0" && 
            codigo != "")
            {
                    let informacion = {  id_proyecto,  id_origen , codigo};



                $.ajax({
                type: 'post',
                //url: '/revit/crearLicencia',
                url: '/revit/validarCodigo',
                data: informacion,
                dataType: 'text'
                })
                .done(function (response) {
                    //console.log(resultado);
                    
                     var resultado = JSON.parse(response);
                    
                    if (resultado.error == 0)
                     {
                         toastr.success('Codigo Ingresado', 'Titulo', {
                                        "progressBar": true
                                    });

                         setTimeout(() => {  console.log("ejecutando");
                                            
                                            }
                                        , 5000);

                        location.reload();
                     }
                     else if (resultado.error == 1)
                     {
                         toastr.error(resultado.tipo, 'Titulo', {
                                        "progressBar": true
                                    });

                         setTimeout(() => {                                             
                                            }
                                        , 5000);
                     }

                });
            }
            else
            {
                toastr.error("Ingresar los campos solicitado", 'Crear Configuración General', {
                                        "progressBar": true
                                    });
            }




}
</script>